<%= form_with model: task, class: "p-6 space-y-6" do |form| %>
  <!-- Error Messages -->
  <% if task.errors.any? %>
    <div class="p-4 bg-red-50 border border-red-200 rounded-xl">
      <div class="flex items-start gap-3">
        <div class="flex-shrink-0">
          <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div>
          <h3 class="text-sm font-semibold text-red-800">
            <%= pluralize(task.errors.count, "error") %> prevented this task from being saved:
          </h3>
          <ul class="mt-2 space-y-1">
            <% task.errors.full_messages.each do |message| %>
              <li class="text-sm text-red-600 flex items-center gap-2">
                <span class="w-1 h-1 rounded-full bg-red-400"></span>
                <%= message %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Title Field -->
  <div>
    <%= form.label :title, class: "block text-sm font-medium text-stone-700 mb-2" %>
    <%= form.text_field :title,
        class: "w-full px-4 py-3 bg-white border rounded-xl shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-terracotta/20 focus:border-terracotta #{task.errors[:title].any? ? 'border-red-300 bg-red-50' : 'border-stone-200'}",
        placeholder: "What needs to be done?",
        maxlength: 100,
        autofocus: true %>
    <% if task.errors[:title].any? %>
      <p class="mt-1.5 text-sm text-red-600 flex items-center gap-1">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
        <%= task.errors[:title].first %>
      </p>
    <% else %>
      <p class="mt-1.5 text-xs text-stone-400"><%= 100 - (task.title&.length || 0) %> characters remaining</p>
    <% end %>
  </div>

  <!-- Description Field -->
  <div>
    <%= form.label :description, class: "block text-sm font-medium text-stone-700 mb-2" %>
    <%= form.text_area :description,
        class: "w-full px-4 py-3 bg-white border border-stone-200 rounded-xl shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-terracotta/20 focus:border-terracotta resize-none",
        placeholder: "Add more details about this task (optional)",
        rows: 4 %>
  </div>

  <!-- Due Date and Priority Row -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    <!-- Due Date Field -->
    <div>
      <%= form.label :due_date, class: "block text-sm font-medium text-stone-700 mb-2" %>
      <%= form.date_field :due_date,
          class: "w-full px-4 py-3 bg-white border border-stone-200 rounded-xl shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-terracotta/20 focus:border-terracotta" %>
      <p class="mt-1.5 text-xs text-stone-400">When should this be done?</p>
    </div>

    <!-- Priority Field -->
    <div>
      <%= form.label :priority, class: "block text-sm font-medium text-stone-700 mb-2" %>
      <%= form.select :priority,
          options_for_select([
            ["ðŸ”¥ High", 3],
            ["âš¡ Medium", 2],
            ["ðŸ“Œ Low", 1]
          ], task.priority || 2),
          {},
          class: "w-full px-4 py-3 bg-white border border-stone-200 rounded-xl shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-terracotta/20 focus:border-terracotta cursor-pointer" %>
      <p class="mt-1.5 text-xs text-stone-400">How urgent is this task?</p>
    </div>
  </div>

  <!-- Completed Checkbox (only show for existing tasks) -->
  <% unless task.new_record? %>
    <div class="pt-2">
      <label class="flex items-center gap-3 cursor-pointer group">
        <%= form.check_box :completed,
            class: "w-5 h-5 rounded border-stone-300 text-sage focus:ring-sage focus:ring-offset-0 cursor-pointer" %>
        <span class="text-sm font-medium text-stone-700 group-hover:text-stone-900 transition-colors">
          Mark as completed
        </span>
      </label>
    </div>
  <% end %>

  <!-- Form Actions -->
  <div class="pt-4 border-t border-stone-100 flex flex-col-reverse sm:flex-row sm:items-center sm:justify-end gap-3">
    <%= link_to task.new_record? ? tasks_path : task_path(task),
        class: "inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-white text-stone-600 font-medium rounded-full border border-stone-200 hover:bg-stone-50 hover:border-stone-300 transition-all duration-200" do %>
      Cancel
    <% end %>

    <%= form.submit task.new_record? ? "Create Task" : "Update Task",
        class: "inline-flex items-center justify-center gap-2 px-6 py-2.5 bg-gradient-to-r from-terracotta to-terracotta-dark text-white font-medium rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 cursor-pointer" %>
  </div>
<% end %>

